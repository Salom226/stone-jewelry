{% extends 'base.html.twig' %}

{% block body %}
<div class="container">
    <h1>Commandes</h1>
    {% include 'layouts/_flash_message.html.twig' %}

    {% for order in orders %}
        <h3>Commande n : {{ order.id }}</h3> <br>
        <span>{% if order.isCompleted == true %}
                <h6 class="text-danger">Commande livrée : {{ order.createdAt|date }}</h6>
                {% else %}
                <h6 class="text-success">Commande non livrée : {{ order.createdAt|date }}</h6>
            {% endif %}
        </span>
        <span>Informations du client</span><br>
    <table class="table table-bordered">
        <tr>
            <th>Nom</th>
            <th>Prénom</th>
            <th>Tel</th>
            <th>Adresse</th>
            <th>Ville</th>
        </tr>
        <tr>
            <td>{{ order.firstName }}</td>
            <td>{{ order.lastName }}</td>
            <td>{{ order.phone }}</td>
            <td>{{ order.adress }}</td>
            <td>{{ order.city.name }}</td>
        </tr>
    </table> 
    <br>
    <h5>Corps de la commande</h5> <br>
    <table class="table table-bordered">
        <tr>
            <th>Image de produit</th>
            <th>Nom du produit</th>
            <th>Description</th>
            <th>Prix unitaire</th>
            <th>Quantité</th>
            <th>Prix total</th>
        </tr>
        {% for product in order.orderProducts %}
            <tr>
                <td><img style="width: 80px; "src="{{ asset('uploads/images/'~product.product.image) }}" alt=""></td>
                <td>{{ product.product.name }}</td>
                <td>{{ product.product.description|slice(0,150) }}</td>
                <td>{{ product.product.price }} Eur</td>
                <td>{{ product.qte }}</td>
                <td>{{ product.product.price*product.qte }} Eur</td>
            </tr>
        {% endfor %}
    </table> 
    <h5>Frais de livraison : {{ order.city.shippingCost }} EUR</h5>
    <h5>Total à payer : {{ order.totalPrice }} EUR</h5>

    <a class="btn btn-outline-success" href="{{ path('app_bill',{'id':order.id}) }}">Imprimer la facture</a>
    {% if order.isCompleted is not same as true %}
    
    <a href="{{ path('app_orders_is_completed_update',{'id':order.id} )}}" class="btn btn-outline-primary col-2 m-lg-1">Marquer comme livrée</a>
    {% endif %}
    <a onclick="return confirm('Voulez-vous vraiment supprimer cette commande ?')" href="{{ path('app_orders_remove',{'id':order.id}) }}" class="btn btn-outline-danger col-2 m-lg-1">Supprimer la commande</a>
    <br><br>
    {% endfor %}

    {{ knp_pagination_render(orders,'layouts/pagination_template.html.twig') }}

</div>
{% endblock %}